---
import Layout from "../../layouts/Layout.astro";
import { galleryImages } from "../../data/images";
import Lightbox from "../../components/common/Lightbox.astro";

export function getStaticPaths() {
    return [
        { params: { lang: "nl" } },
        { params: { lang: "en" } },
        { params: { lang: "de" } },
    ];
}

const { lang } = Astro.params;
const title = { nl: "Gallerij", en: "Gallery", de: "Galerie" }[
    lang as "nl" | "en" | "de"
];
---

<Layout title={`${title} - Logies De Reiziger`}>
    <!-- Hero Section -->
    <div class="relative bg-primary text-white py-20 overflow-hidden">
        <div class="absolute inset-0 bg-black/20 z-0"></div>
        <div class="container mx-auto px-4 text-center relative z-10">
            <h1
                class="font-serif text-4xl md:text-5xl font-bold mb-4 opacity-0 animate-fade-in-down"
            >
                {title}
            </h1>
            <div
                class="w-24 h-1 bg-accent mx-auto rounded-full opacity-0 animate-fade-in-up delay-200"
            >
            </div>
        </div>
    </div>

    <!-- Gallery Grid -->
    <section class="py-16 md:py-24 bg-secondary/30">
        <div class="container mx-auto px-4 max-w-7xl">
            <div class="columns-1 sm:columns-2 md:columns-3 gap-6 space-y-6">
                {
                    galleryImages.map((src, index) => (
                        <div
                            class="group relative overflow-hidden rounded-xl shadow-md cursor-pointer break-inside-avoid opacity-0 hover:shadow-xl transition-shadow duration-300 lightbox-trigger"
                            data-index={index}
                        >
                            <img
                                src={src}
                                alt={`Gallery image ${index + 1}`}
                                class="w-full h-auto object-cover transform transition-transform duration-700 ease-out group-hover:scale-105"
                                loading="lazy"
                            />
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                                <div class="bg-white/20 backdrop-blur-md p-3 rounded-full text-white transform scale-75 group-hover:scale-100 transition-all duration-300">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"
                                        />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </section>

    <!-- Lightbox -->
    <Lightbox />
</Layout>

<style>
    /* Custom Animations */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in-down {
        animation: fadeInDown 0.8s ease-out forwards;
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
    }

    .delay-200 {
        animation-delay: 200ms;
    }

    /* Helper to hide scrollbar when lightbox is open */
    :global(body.lightbox-open) {
        overflow: hidden;
    }
</style>

<script>
    import { initLightbox } from "../../scripts/lightbox";

    document.addEventListener("astro:page-load", () => {
        // Initialize lightbox on triggers
        // We assume gallery items have the trigger class
        initLightbox(".lightbox-trigger");

        // Keep the fade-in animation observer
        const galleryItems = document.querySelectorAll(".group[data-index]");
        const observerOptions = {
            root: null,
            rootMargin: "0px",
            threshold: 0.1,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.remove("opacity-0");
                        entry.target.classList.add("animate-fade-in-up");
                    }, 50);
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        galleryItems.forEach((item) => {
            observer.observe(item);
        });
    });
</script>
